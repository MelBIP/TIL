# UIKit 공부
## Diffable Datasource
---
- 기존의 DataSource와 UI는 각각 시간에 따라 변경되는 자신만의 버전(truth)을 가지고 있는데, 이것이 맞지 않으면 에러가 발생.
- reladData를 수행하기 전까지는 중앙화된 하나의 버전(truth)가 존재하지 않아 에러가 발생하기 쉬움.
- reloadData를 수행하더라도 애니메이션없이 화면을 갱신하게 되기 때문에 사용자 경험을 저하시킬 수 있음.

**개념**
- 그에 따라 Apple에서 도입한 것이 Differable DataSource. performBatchUpdates()같은 복잡한 메소드를 사용하지 않고, apply()라는 하나의 메소드로 관리하게 됨.
- **Snapshot** : UI의 버전(truth)를 저장하는 개념. 각 section과 item에 대한 unique identifier를 저장하고 이를 기반으로 업데이트를 수행함. (IndexPath를 기반으로 업데이트하던 기존의 방식과 다른 점) apply()를 수행하면 새로운 snapshot이 적용됨.

**사용방법**
**가장 먼저 UICollectionViewDiffableDataSource를 생성해야 함. (TableView도 과정은 유사)**
UICollectionViewDiffableDataSource의 정의
- 정의된 UICollectionViewDiffableDataSource를 보면 Generic Class임을 알 수 있음.
- 또한 Generic에 해당하는 SectionIdentifierType과 ItemIdentifierType 모두 Hashable을 준수하는 타입이어야 함.
- cf. SectionIdentifierType : Section을 구분할 타입, 일반적으로 custom enum 혹은 int가 들어감. (반드시 Hashable해야 함)
- cf. ItemIdentifierType : Item을 구분할 타입, 일반적으로 custom class가 들어감. (반드시 Hashable해야 함)
```swift
dataSource = UICollectionViewDiffableDataSource<Int, UUID>(collectionView: collectionView) {
    (collectionView: UICollectionView, indexPath: IndexPath, itemIdentifier: UUID) -> UICollectionViewCell? in
    // configure and return cell
}
```
- 생성자를 통해 DiffableDataSource를 만듦.
- collectionView 파라미터에는 dataSource가 사용될 collectionView를 넣어주면 됨.
- 다음 파라미터가 되는 cellProvider(클로저)에는 cell을 구성하는 코드를 작성함.
- 클로저 내부에서 collectionView와 indexPath, itemIdentifier 모두 제공하기 때문에 이를 활용해 cell을 구현하면 됨. (collectionView에서 indexPath를 통해 cell을 가져오고 itemIdentifier를 기반으로 cell을 구성)

이제 Snapshot을 생성해서 apply해주어야 함.

NSDiffableDataSourceSnapshot의 정의
- UICollectionViewDiffableDataSource와 마찬가지로 SectionIdentifierType과 ItemIdentifierType를 필요로 함.
- UICollectionViewDiffableDataSource에서 선언해준 타입과 일치시켜주어야 함.
```swift
// Create a snapshot.
var snapshot = NSDiffableDataSourceSnapshot<Int, UUID>()        

// Populate the snapshot.
snapshot.appendSections([0])
snapshot.appendItems([UUID(), UUID(), UUID()])

// Apply the snapshot.
dataSource.apply(snapshot, animatingDifferences: true)
```
- NSDiffableDataSourceSnapshot을 통해 Snapshot을 생성하고 이를 datasoure의 apply메소드에 전달해주는 방식으로 업데이트 진행
- 원하는 곳에 위와 같은 구조의 코드를 입력해 갱신될 수 있도록 처리하면 됨.
- animatingDifferences 옵션을 true로 하면 애니메이션과 함께 변경사항을 보여줌.
