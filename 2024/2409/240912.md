# iOS 공부
## UNUserNotificationCenter
---
**UNUserNotificationCenter**
- UNUserNotificationCenter는 앱 혹은 앱 확장에서 발생하는 알림 관련 활동들을 관리할 수 있는 중앙 객체.
- 앱에서 관련된 기능을 다루기 위해서는 우선 권한을 요청해야 함.
- options에 필요한 권한을 포함시켜 전달하고, 그 결과를 completionHandler로 받아 추가 작업을 수행.
- options에 포함시킬 수 있는 권한
  - **badge**
    - badge - 앱아이콘 오른쪽 위에 표기되는 알림 개수
  - **sound**
  - **alert**
  - **carPlay**
  - **criticalAlert**
  - **providersAppNotificationSettings**
  - **provisional**
- 싱글톤 객체를 제공하기 때문에 이를 활용하면 됨.
  - 싱글톤 패턴 - 특정 클래스의 인스턴스를 1개만 생성되는 것을 보장하는 디자인 패턴. 즉, 생성자를 통해서 여러 번 호출이 되더라도 인스턴스를 새로 생성하지 않고 최초 호출 시에 만들어두었떤 인스턴스를 재활용하는 패턴
- 여기에 UNNotificationRequest 객체를 추가해서 알림을 설정함.

**UNMutableNotificationContent**
- 알림의 내용을 설정할 수 있는 객체.
- **title**, **subtitle**, **body**, **badge**, **sound** 등을 설정할 수 있음.

**UNNotificationTrigger**
- 알림을 트리거하는 조건에 대한 패턴을 정의할 수 있는 추상 클래스.
- 이에 대한 구체타입으로는 아래 4가지가 존재함.
  - **UNTimeIntervalNotificationTrigger**
    ```swift
    // Fire in 30 minutes (60 seconds times 30)
    let trigger = UNTimeIntervalNotificationTrigger(timeInterval: (30*60), repeats: false)
    ```
    - 설정한 timeInterval 값이 지나면 알림을 트리거함.
  - **UNCalendarNotificationTrigger**
    ```swift
    var date = DateComponents()
    date.hour = 8
    date.minute = 30 
    let trigger = UNCalendarNotificationTrigger(dateMatching: date, repeats: true)
    ```
    - 특정 날짜 혹은 시간에 알림을 트리거함.
    - 내부 값으로는 DataComponet 객체를 활용함
  - **UNLocationNotificationTrigger**
    ```swift
    let center = CLLocationCoordinate2D(latitude: 37.335400, longitude: -122.009201)
    let region = CLCircularRegion(center: center, radius: 2000.0, identifier: "Headquarters")
    region.notifyOnEntry = true
    region.notifyOnExit = false
    let trigger = UNLocationNotificationTrigger(region: region, repeats: false)
    ```
    - 특정 지역에 도착했을 때 알림을 트리거함.
  - **UNPushNotificationTrigger**
    - Apple Push Notification Service (APNs)에서 알림을 보냈을 때 알림을 트리거함.
    - 사용자가 직접 해당 클래스를 생성하여 사용할 일은 없음.

**UNNotificationRequest**
- 알림을 요청하는 핵심객체. 
- 내부에 UNMutableNotificationContent 및 UNNotificationTrigger가 포함됨.
- identifier도 포함되기 때문에 추후 UNUserNotificationCenter에서 이를 기반으로 알림 삭제도 가능함.

## Operation Queue
---
**Operation Queue**
- Swift에서 Concurrency Programming을 구현할 때 사용하는 API 중 하나로, 주로 작업 사이에 의존성을 부여하거나 최소 기능을 구현할 때 사용함.

**Opteration**
- 하나의 작업을 나타내는 객체로, 보통 Operation class를 상속한 BlockOperation class를 사용하거나 직접 Operation class를 상속받고 Custom Operation을 구현하여 사용함.
- Operation은 서로에게 의존성을 부여할 수 있음.
  - 또한 취소가 가능함.
  - Completion Handler를 적용할 수 있음.
- Single-shot Object (실행이 완료된 인스턴스는 재실행이 불가능)
- Ready - Executing - Finished / Cancelled의 상태를 가짐.
```swift
let op = BlockOperation {
    ...
}

op.addExecutionBlock {
    ...
}

op.comletionBlock = {
    ...
}
```
- 기본적인 BlockOperation 객체를 생성함.
- addExecutionBlock 메서드를 통해 작업(Block)을 추가할 수도 있음.
- comletionBlock 속성에 작업이 종료된 후에 수행할 작업을 정의할 수도 있음.

**Operation Queue**
- Operation들을 Queue로 관리함.
- 어떤 Operation을 먼저 실행할지는 우선순위 및 의존성에 따라 결정됨.
- 내부적으로 사용가능한 리소스를 계산하여 동시에 실행할 수 있는 작업은 동시에 실행하며 최대한 빨리 처리함.
```swift
let queue = OperationQueue()

queue.addOperation(op)

queue.cancelAllOperations()
```
- addOperation 메서드를 통해 operation을 추가할 수 있음.
- cancelAllOperations 메서드를 통해 모든 operation을 cancel할 수 있음.
  - 다만 이렇게 한다고 수행 중인 operation이 중지되는 것은 아님.
  - 단지 operation 내부의 isCancelled 옵션이 true로 변경될 뿐
  - 따라서 해당 옵션에 확인해 작업을 중지하도록 구현된 경우에만 실질적 작업이 중지됨
    - ex. if isCancelled {return}
  - 이런식으로 작업이 취소된 경우 완료된 것으로 간주되어 completionBlock이 존재한다면 실행됨.

**Operation Priority**
- Operation Priority는 Operation들이 우선순위를 결정함.
- Operation Priority는 총 5가지가 존재함.
  - verHigh
  - high
  - normal (default)
  - low
  - varyLow
- 더 높은 우선순위의 Operation이 우선적으로 처리됨.

**Quality of Service**
- 리스소를 사용할 우선순위를 결정함.
- 우선순위가 높을수록 리소스(CPU, 메모리, 네트워크 등)을 더 오래 사용할 수 있음.
- Quality of Service는 총 4가지가 존재함.
  - userInteractive
  - userInitiated
  - utility
  - background (default)

**Interoperation Dependencies**
- Operation Queue에서는 Operation끼리의 의존성을 추가해 실행 순서를 결정할 수 있음.
- addDependency_: 메서드, removeDependency_: 메서드, dependencies 속성을 통해 관련 작업을 수행할 수 있음.
- addDependency 메서드로 특정 Operation에 따른 Operation이 추가할 수 있음. 이 경우 추가된 다른 Operation이 완료되어야 해당 Operation 작업이 수행됨.
- removeDependency 메서드로 특정 Operation 의존성을 제거할 수 있음.
- dependencies 속성을 통해 현재 Operation이 의존하고 있는 Operation의 목록을 확인할 수 있음.