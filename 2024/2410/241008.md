# RxSwift 공부
## ControlProperty, ControlEvent
---
#### ControlProperty
ControlProperty는 Subject처럼 프로퍼티에 값을 주입할 수 있고 동시에 값의 변화도 관찰할 수 있는 타입임. 이는 `(UIElement).rx`를 통해 접근할 수 있음. ControlProperty를 사용하면 해당하는 프로퍼티의 변경사항을 데이터 시퀀스로 받아올 수 있음.

`UITextField+Rx.Swift`의 구현 예시
```swift
extension Reactive where Base: UITextField {
    ...
    public var text: ControlProperty<String?> {
        return value
    }
    ...
}
```
내부에 존재하는 text가 ControlProperty 타입임. 이는 `(UITextField).rx.text`로 접근할 수 있음. ControlProperty는 `bind(to:)` 메서드를 통해 subscribe를 수행할 수 있음. (`bind(to:)는 일종의 syntax suger로, 사용자에게 좀 더 직관적인 이해를 제공함. 내부적인 처리는 subscribe와 동일함.)

**Binder**
RxCocoa에는 내부 property를 Observer처럼 제공해 변경사항을 이에 바로 적용할 수 있도록 하는 기능도 존재함. 이를 Binder라고 함.

`UILabel+Rx.Swift`의 구현 내용
```swift
extension Reactive where Base: UILabel {
    ...
    public var text: Binder<String?> {
        return Binder(self.base) { label, text in
            label.text = text
        }
    }
```
내부에서 Binder라는 타입을 사용하고 있음. 데이터를 받아오면 이를 바로 UI Elements에 적용함.
```swift
public struct Binder<Value>: ObserverType {
    ...
}
```
`Binder` 타입의 정의를 보니 이 역시 ObserverType의 일종임을 확인할 수 있음.

ControlProperty와 Binder를 활용해 데이터 시퀀스의 반환 및 적용하는 예시
```swift
let results = query.rx.text
    .throttle(.milliseconds(300), scheduler: MainScheduler.instance)
    .flatMapLatest { query in
        fetchAutoCompleteItems(query)
    }

results
    .map { "\($0.count)" }
    .bind(to: resultCount.rx.text)
    .disposed(by: disposeBag)
```
`query.rx.text`라는 ControlProperty를 통해 `fetchAutoCompleteItems`에 query를 날리고 이 반환값을 `resultCount.rx.text`라는 binder에 적용하고 있음.

#### ControlEvent
Cocoa에는 수많은 Event가 발생함. 그 이벤트는 ViewController가 Load되면 발생하는 ViewDidLoad에 대한 메세지가 될 수도 있고, User로 인해 발생하는 Tap Event가 될 수도 있음. ControlEvent는 이러한 Event들에 대한 시퀀서를 받아올 수 있는 기능임.

`UICollectionView+Rx`의 구현 예시
```swift
extension Reactive where Base: UICollectionView {

    /// Reactive wrapper for `delegate` message `collectionView:didSelectItemAtIndexPath:`.
    public var itemSelected: ControlEvent<IndexPath> {
        let source = delegate.methodInvoked(#selector(UICollectionViewDelegate.collectionView(_:didSelectItemAt:)))
            .map { a in
                return a[1] as! IndexPath
            }

        return ControlEvent(events: source)
    }
}
```
내부에서 itemSelected가 ControlEvent라는 타입을 사용하고 있음. 이는 `(UICollectionView)rx.itemSelected`로 접근할 수 있음. 이 역시 ControlProperty와 같이 bind하여 필요한 작업을 수행할 수 있음.